<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Parking Simulation</title>
  <meta name="Author" content="Mongkut Piantanakulchai">
  <meta name="Subject" content="Parking">
  <meta name="Keywords" content="parking simulation">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #b76ff7; -webkit-text-stroke: #b76ff7}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #d4d4d4; -webkit-text-stroke: #d4d4d4}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none}
    span.s8 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s9 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s10 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s11 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s12 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s13 {font-kerning: none; color: #4ca786; background-color: #171818; -webkit-text-stroke: 0px #4ca786}
    span.s14 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s15 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Vehicle Bay Simulation Dashboard (M/M/s &amp; M/D/s)</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- Tailwind CSS for UI --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- Chart.js for Visualization --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.jsdelivr.net/npm/chart.js"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">/* Custom Scrollbar for Sidebar */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s2">width:</span><span class="s4"> </span><span class="s9">8px</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-track</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s2">background:</span><span class="s4"> #f1f1f1</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-thumb</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s2">background:</span><span class="s4"> #888</span><span class="s8">;</span><span class="s4"> </span><span class="s2">border-radius:</span><span class="s4"> </span><span class="s9">4px</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">::-webkit-scrollbar-thumb:hover</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s2">background:</span><span class="s4"> #555</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">body</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">font-family:</span><span class="s4"> </span><span class="s10">'Inter'</span><span class="s8">,</span><span class="s4"> </span><span class="s5">sans-serif</span><span class="s8">;</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #f3f4f6</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.card</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">background:</span><span class="s4"> </span><span class="s5">white</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">0.5rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">box-shadow:</span><span class="s4"> </span><span class="s9">0</span><span class="s4"> </span><span class="s9">1px</span><span class="s4"> </span><span class="s9">3px</span><span class="s4"> </span><span class="s5">rgba(</span><span class="s9">0</span><span class="s8">,</span><span class="s9">0</span><span class="s8">,</span><span class="s9">0</span><span class="s8">,</span><span class="s9">0.1</span><span class="s5">)</span><span class="s8">;</span><span class="s4"> </span><span class="s1">padding:</span><span class="s4"> </span><span class="s9">1rem</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.input-group</span><span class="s4"> </span><span class="s6">label</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">display:</span><span class="s4"> </span><span class="s5">block</span><span class="s8">;</span><span class="s4"> </span><span class="s1">font-size:</span><span class="s4"> </span><span class="s9">0.875rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">font-weight:</span><span class="s4"> </span><span class="s9">500</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> #374151</span><span class="s8">;</span><span class="s4"> </span><span class="s1">margin-bottom:</span><span class="s4"> </span><span class="s9">0.25rem</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.input-group</span><span class="s4"> </span><span class="s6">input</span><span class="s8">,</span><span class="s4"> </span><span class="s6">.input-group</span><span class="s4"> </span><span class="s6">select</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">width:</span><span class="s4"> </span><span class="s9">100%</span><span class="s8">;</span><span class="s4"> </span><span class="s1">padding:</span><span class="s4"> </span><span class="s9">0.5rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border:</span><span class="s4"> </span><span class="s9">1px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #d1d5db</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">0.375rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">font-size:</span><span class="s4"> </span><span class="s9">0.875rem</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">padding:</span><span class="s4"> </span><span class="s9">0.5rem</span><span class="s4"> </span><span class="s9">1rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">0.375rem</span><span class="s8">;</span><span class="s4"> </span><span class="s1">font-weight:</span><span class="s4"> </span><span class="s9">600</span><span class="s8">;</span><span class="s4"> </span><span class="s1">cursor:</span><span class="s4"> </span><span class="s5">pointer</span><span class="s8">;</span><span class="s4"> </span><span class="s1">transition:</span><span class="s4"> </span><span class="s5">all</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-primary</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #2563eb</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> </span><span class="s5">white</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-primary:hover</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #1d4ed8</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-secondary</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #4b5563</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> </span><span class="s5">white</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">.btn-secondary:hover</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s2">background-color:</span><span class="s4"> #374151</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-success</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #059669</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> </span><span class="s5">white</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-outline</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #d1d5db</span><span class="s8">;</span><span class="s1"> </span><span class="s2">background:</span><span class="s1"> </span><span class="s5">white</span><span class="s8">;</span><span class="s1"> </span><span class="s2">color:</span><span class="s1"> #374151</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-outline:hover</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #f3f4f6</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-visual</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">background-color:</span><span class="s4"> #7c3aed</span><span class="s8">;</span><span class="s4"> </span><span class="s1">color:</span><span class="s4"> </span><span class="s5">white</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span><span class="s4"> </span><span class="s11">/* Purple for Visual */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.btn-visual:hover</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #6d28d9</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">/* Loader */</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s6">.loader</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">border:</span><span class="s4"> </span><span class="s9">3px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #f3f3f3</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border-top:</span><span class="s4"> </span><span class="s9">3px</span><span class="s4"> </span><span class="s5">solid</span><span class="s4"> #3498db</span><span class="s8">;</span><span class="s4"> </span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s9">50%</span><span class="s8">;</span><span class="s4"> </span><span class="s1">width:</span><span class="s4"> </span><span class="s9">20px</span><span class="s8">;</span><span class="s4"> </span><span class="s1">height:</span><span class="s4"> </span><span class="s9">20px</span><span class="s8">;</span><span class="s4"> </span><span class="s1">animation:</span><span class="s4"> </span><span class="s5">spin</span><span class="s4"> </span><span class="s9">1s</span><span class="s4"> </span><span class="s5">linear</span><span class="s4"> </span><span class="s5">infinite</span><span class="s8">;</span><span class="s4"> </span><span class="s1">display:</span><span class="s4"> </span><span class="s5">inline-block</span><span class="s8">;</span><span class="s4"> </span><span class="s1">vertical-align:</span><span class="s4"> </span><span class="s5">middle</span><span class="s8">;</span><span class="s4"> </span><span class="s1">margin-right:</span><span class="s4"> </span><span class="s9">5px</span><span class="s8">;</span><span class="s4"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">@keyframes</span><span class="s1"> </span><span class="s5">spin</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s9">0%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s9">0deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s9">100%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s9">360deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"h-screen flex overflow-hidden"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- Sidebar: Inputs --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">aside</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-80 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col h-full overflow-y-auto z-10"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 border-b border-gray-200 bg-gray-50"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s4">Vehicle Bay Sim</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500 mt-1"</span><span class="s3">&gt;</span><span class="s1">Discrete Event Simulation (DES)</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 space-y-4 flex-1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Traffic Parameters --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2"</span><span class="s3">&gt;</span><span class="s4">Traffic &amp; Service</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Arrival Rate (Lambda)"</span><span class="s3">&gt;</span><span class="s1">Arrival Rate (veh/hr)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"arrival_rate"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"300"</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0"</span><span class="s4"> </span><span class="s2">max</span><span class="s3">=</span><span class="s1">"2000"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Mean Service Time (1/Mu)"</span><span class="s3">&gt;</span><span class="s1">Mean Dwell Time (sec)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"dwell_time"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"30"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s5">"1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s3">&gt;</span><span class="s1">Distribution</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">select</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"service_dist"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"exponential"</span><span class="s3">&gt;</span><span class="s1">Exponential (M/M/s)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"fixed"</span><span class="s3">&gt;</span><span class="s1">Fixed (M/D/s)</span><span class="s3">&lt;/</span><span class="s6">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">select</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Capacity --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2"</span><span class="s3">&gt;</span><span class="s4">System Capacity</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Number of Servers (s)"</span><span class="s3">&gt;</span><span class="s1">Number of Bays (s)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"num_bays"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"5"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s5">"1"</span><span class="s1"> </span><span class="s2">max</span><span class="s3">=</span><span class="s5">"40"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Max queue size"</span><span class="s3">&gt;</span><span class="s1">Queue Capacity</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"queue_cap"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"999"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s5">"1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Simulation Settings --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2"</span><span class="s3">&gt;</span><span class="s4">Sim Parameters</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s3">&gt;</span><span class="s1">Duration (minutes)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"duration_min"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"60"</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Stats collection starts after this"</span><span class="s3">&gt;</span><span class="s1">Warmup (minutes)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"warmup_min"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"10"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s5">"0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s3">&gt;</span><span class="s1">Random Seed</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"seed"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"12345"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s1"> </span><span class="s2">title</span><span class="s3">=</span><span class="s5">"Sampling rate for charts"</span><span class="s3">&gt;</span><span class="s1">Chart Step (sec)</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s5">"number"</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"time_step"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s5">"10"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s5">"1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"input-group"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Number of iterations for batch run"</span><span class="s3">&gt;</span><span class="s4">Batch Runs</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"batch_runs"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"50"</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">max</span><span class="s3">=</span><span class="s1">"1000"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Action Buttons --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 border-t border-gray-200 bg-gray-50 space-y-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"space-y-2"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"toggleVisualSimulation()"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"btn-visual"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-visual w-full flex justify-center items-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1">ğŸ‘ï¸</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> &amp;nbsp; Live Visualization</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center space-x-2 px-1"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-gray-500 font-bold whitespace-nowrap"</span><span class="s4"> </span><span class="s2">style</span><span class="s3">=</span><span class="s1">"min-width: 60px;"</span><span class="s3">&gt;</span><span class="s4">Speed: </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"speed-label"</span><span class="s3">&gt;</span><span class="s4">5x</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"range"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"speed-slider"</span><span class="s4"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"1"</span><span class="s4"> </span><span class="s2">max</span><span class="s3">=</span><span class="s1">"50"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"5"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"runSingleSimulation()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full flex justify-center items-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"btn-run-icon"</span><span class="s3">&gt;</span><span class="s1">â–¶</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> &amp;nbsp; Run Stats (Fast)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-2 gap-2"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"runBatchSimulation()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary text-sm"</span><span class="s3">&gt;</span><span class="s4">Run Batch</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"runScenarioSweep()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-outline text-sm"</span><span class="s3">&gt;</span><span class="s4">Sweep Lambda</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"exportCSV()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-outline w-full text-sm"</span><span class="s3">&gt;</span><span class="s4">Export CSV</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"status-msg"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-center text-gray-500 h-4"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;/</span><span class="s1">aside</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">&lt;!-- Main Content --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">main</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 flex flex-col h-full overflow-hidden"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Metrics Header --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white border-b border-gray-200 p-4 shadow-sm z-10"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"metrics-panel"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Metrics inserted by JS --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center p-2 bg-gray-50 rounded"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Utilization</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s4">-</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center p-2 bg-gray-50 rounded"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Avg Queue (Lq)</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s4">-</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center p-2 bg-gray-50 rounded"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Avg Wait (Wq)</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s4">-</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center p-2 bg-gray-50 rounded"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-xs text-gray-500"</span><span class="s3">&gt;</span><span class="s1">Prob(Queue&gt;0)</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s4">-</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Scrollable Content Area --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 overflow-y-auto p-4 space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- MAIN DASHBOARD SPLIT --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col xl:flex-row gap-4"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- LEFT: Visualization (Hidden by default) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"visual-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden xl:w-7/12 card p-0 overflow-hidden relative h-[340px]"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"visual-canvas"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full h-full bg-gray-800"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute top-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded border border-white/20 backdrop-blur-sm"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>Live Sim </span><span class="s3">&lt;</span><span class="s6">br</span><span class="s3">&gt;</span><span class="s1"> </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"visual-time"</span><span class="s3">&gt;</span><span class="s1">00:00</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Legend Top-Right --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute top-2 right-2 text-white text-xs space-x-2 bg-black/30 px-2 py-1 rounded backdrop-blur-sm"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"inline-block w-2 h-2 rounded-full bg-amber-400"</span><span class="s3">&gt;&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s4"> Waiting</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"inline-block w-2 h-2 rounded-full bg-blue-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s4"> Parking</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"inline-block w-2 h-2 rounded-full bg-emerald-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s4"> Leaving</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- RIGHT: Charts Grid (Expands when visual is hidden) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"charts-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-40 p-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-system"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-40 p-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-queue"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-40 p-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-wait-hist"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-40 p-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-sweep"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Validation &amp; Interpretation --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 lg:grid-cols-3 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card lg:col-span-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm font-bold text-gray-700 mb-2"</span><span class="s3">&gt;</span><span class="s1">Theoretical Validation (M/M/s Only)</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"overflow-x-auto"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">table</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full text-sm text-left"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">thead</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"bg-gray-100 text-gray-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2"</span><span class="s3">&gt;</span><span class="s1">Metric</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2"</span><span class="s3">&gt;</span><span class="s1">Simulated</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2"</span><span class="s3">&gt;</span><span class="s1">Theoretical</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2"</span><span class="s3">&gt;</span><span class="s1">Diff %</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">th</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2"</span><span class="s3">&gt;</span><span class="s1">Status</span><span class="s3">&lt;/</span><span class="s6">th</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">thead</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">tbody</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"validation-table"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">tr</span><span class="s3">&gt;&lt;</span><span class="s6">td</span><span class="s1"> </span><span class="s2">colspan</span><span class="s3">=</span><span class="s5">"5"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"p-2 text-center text-gray-400"</span><span class="s3">&gt;</span><span class="s1">Run simulation to see validation</span><span class="s3">&lt;/</span><span class="s6">td</span><span class="s3">&gt;&lt;/</span><span class="s6">tr</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">tbody</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">table</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"card bg-blue-50 border border-blue-100"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm font-bold text-blue-800 mb-2"</span><span class="s3">&gt;</span><span class="s4">Interpretation</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">ul</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-blue-700 space-y-2 list-disc pl-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;&lt;</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1">Input Check:</span><span class="s3">&lt;/</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1"> Charts below confirm if random arrivals/service match theoretical M/M (Exponential) distributions.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;&lt;</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1">Utilization:</span><span class="s3">&lt;/</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1"> % of time bays are occupied.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;&lt;</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1">Lq (Queue Len):</span><span class="s3">&lt;/</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1"> Avg number of vehicles waiting.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;&lt;</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1">Wq (Wait Time):</span><span class="s3">&lt;/</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1"> Avg time a vehicle waits.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">ul</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"stability-warning"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden mt-3 p-2 bg-red-100 text-red-700 text-xs font-bold rounded border border-red-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>âš ï¸ System Unstable (Rho â‰¥ 1). Queue will explode.</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">&lt;!-- Input Distribution Validation --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 lg:grid-cols-2 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-64"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-arrival-dist"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"card h-64"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"chart-service-dist"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s3">&lt;/</span><span class="s6">main</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>* RANDOM NUMBER GENERATOR (Mulberry32)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>*/</span></p>
<p class="p7"><span class="s12">class</span><span class="s4"> </span><span class="s1">Random</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">constructor</span><span class="s8">(</span><span class="s4">seed</span><span class="s8">)</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">seed </span><span class="s8">=</span><span class="s1"> seed</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>next</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">var</span><span class="s1"> t </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">seed </span><span class="s8">+=</span><span class="s1"> </span><span class="s13">0x6D2B79F5</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>t </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">imul</span><span class="s8">(</span><span class="s1">t </span><span class="s8">^</span><span class="s1"> </span><span class="s8">(</span><span class="s1">t </span><span class="s8">&gt;&gt;&gt;</span><span class="s1"> </span><span class="s15">15</span><span class="s8">),</span><span class="s1"> t </span><span class="s8">|</span><span class="s1"> </span><span class="s15">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>t </span><span class="s8">^=</span><span class="s1"> t </span><span class="s8">+</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">imul</span><span class="s8">(</span><span class="s1">t </span><span class="s8">^</span><span class="s1"> </span><span class="s8">(</span><span class="s1">t </span><span class="s8">&gt;&gt;&gt;</span><span class="s1"> </span><span class="s15">7</span><span class="s8">),</span><span class="s1"> t </span><span class="s8">|</span><span class="s1"> </span><span class="s15">61</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s8">((</span><span class="s1">t </span><span class="s8">^</span><span class="s1"> </span><span class="s8">(</span><span class="s1">t </span><span class="s8">&gt;&gt;&gt;</span><span class="s1"> </span><span class="s15">14</span><span class="s8">))</span><span class="s1"> </span><span class="s8">&gt;&gt;&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">4294967296</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>exponential</span><span class="s8">(</span><span class="s1">rate</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Quantile function for Exponential: -ln(1-u) / lambda</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s8">-</span><span class="s14">Math</span><span class="s8">.</span><span class="s1">log</span><span class="s8">(</span><span class="s15">1</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">next</span><span class="s8">())</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> rate</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>* 1. FAST DISCRETE EVENT SIMULATION (For Stats/Charts)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>*/</span></p>
<p class="p7"><span class="s12">const</span><span class="s4"> </span><span class="s1">EVENTS</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s8">{</span><span class="s4"> </span><span class="s1">ARRIVAL</span><span class="s8">:</span><span class="s4"> </span><span class="s15">0</span><span class="s8">,</span><span class="s4"> </span><span class="s1">DEPARTURE</span><span class="s8">:</span><span class="s4"> </span><span class="s15">1</span><span class="s4"> </span><span class="s8">};</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p7"><span class="s12">class</span><span class="s4"> </span><span class="s1">Simulation</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">constructor</span><span class="s8">(</span><span class="s1">config</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Random</span><span class="s8">(</span><span class="s1">config</span><span class="s8">.</span><span class="s1">seed</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">reset</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>reset</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">events </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>arrivals</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> completed</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> overflow</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>totalQueueTimeArea</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> totalSystemTimeArea</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> serverBusyTimeArea</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>totalWaitTime</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> totalSystemTime</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> waitCount</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>zeroQueueTime</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> maxQueue</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Input validation data</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">interArrivalSample </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">serviceSample </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">timeSeries </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextSampleTime </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>schedule</span><span class="s8">(</span><span class="s1">type</span><span class="s8">,</span><span class="s1"> time</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> event </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> type</span><span class="s8">,</span><span class="s1"> time</span><span class="s8">,</span><span class="s1"> data </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> added </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">for</span><span class="s1"> </span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">.</span><span class="s1">length</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">[</span><span class="s1">i</span><span class="s8">].</span><span class="s1">time </span><span class="s8">&gt;</span><span class="s1"> time</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">.</span><span class="s1">splice</span><span class="s8">(</span><span class="s1">i</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> event</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>added </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span><span class="s1"> </span><span class="s12">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">added</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">event</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>run</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> arrivalRatePerSec </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">/</span><span class="s1"> </span><span class="s15">3600</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> endTime </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">durationMin </span><span class="s8">*</span><span class="s1"> </span><span class="s15">60</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> warmupTime </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">warmupMin </span><span class="s8">*</span><span class="s1"> </span><span class="s15">60</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Schedule first arrival</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> firstIA </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s1">arrivalRatePerSec</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">firstIA</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// Track inputs</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">schedule</span><span class="s8">(</span><span class="s14">EVENTS</span><span class="s8">.</span><span class="s14">ARRIVAL</span><span class="s8">,</span><span class="s1"> firstIA</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">while</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> evt </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">events</span><span class="s8">.</span><span class="s1">shift</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">evt</span><span class="s8">.</span><span class="s1">time </span><span class="s8">&gt;</span><span class="s1"> endTime</span><span class="s8">)</span><span class="s1"> </span><span class="s12">break</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> dt </span><span class="s8">=</span><span class="s1"> evt</span><span class="s8">.</span><span class="s1">time </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">&gt;=</span><span class="s1"> warmupTime</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateTimeWeightedStats</span><span class="s8">(</span><span class="s1">dt</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">evt</span><span class="s8">.</span><span class="s1">time </span><span class="s8">&gt;</span><span class="s1"> warmupTime</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateTimeWeightedStats</span><span class="s8">(</span><span class="s1">evt</span><span class="s8">.</span><span class="s1">time </span><span class="s8">-</span><span class="s1"> warmupTime</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">while</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextSampleTime </span><span class="s8">&lt;=</span><span class="s1"> evt</span><span class="s8">.</span><span class="s1">time</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextSampleTime </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> t</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextSampleTime</span><span class="s8">,</span><span class="s1"> q</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length</span><span class="s8">,</span><span class="s1"> sys</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextSampleTime </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">timeStep</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">=</span><span class="s1"> evt</span><span class="s8">.</span><span class="s1">time</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">evt</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s14">EVENTS</span><span class="s8">.</span><span class="s14">ARRIVAL</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">handleArrival</span><span class="s8">(</span><span class="s1">arrivalRatePerSec</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">handleDeparture</span><span class="s8">(</span><span class="s1">evt</span><span class="s8">.</span><span class="s1">data</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">computeFinalMetrics</span><span class="s8">(</span><span class="s1">warmupTime</span><span class="s8">,</span><span class="s1"> endTime</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>updateTimeWeightedStats</span><span class="s8">(</span><span class="s1">dt</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalQueueTimeArea </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">*</span><span class="s1"> dt</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalSystemTimeArea </span><span class="s8">+=</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> dt</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">serverBusyTimeArea </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy </span><span class="s8">*</span><span class="s1"> dt</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">zeroQueueTime </span><span class="s8">+=</span><span class="s1"> dt</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">maxQueue</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">maxQueue </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>handleArrival</span><span class="s8">(</span><span class="s1">lambda</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Generate Next Arrival</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ia </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s1">lambda</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Store for validation check (cap to avoid memory issues on huge runs)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">5000</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">ia</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">schedule</span><span class="s8">(</span><span class="s14">EVENTS</span><span class="s8">.</span><span class="s14">ARRIVAL</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">+</span><span class="s1"> ia</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">warmupMin </span><span class="s8">*</span><span class="s1"> </span><span class="s15">60</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">arrivals</span><span class="s8">++;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">schedule</span><span class="s8">(</span><span class="s14">EVENTS</span><span class="s8">.</span><span class="s14">DEPARTURE</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">getServiceTime</span><span class="s8">(),</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> arrivalTime</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime</span><span class="s8">,</span><span class="s1"> startService</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">queueCap</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">warmupMin </span><span class="s8">*</span><span class="s1"> </span><span class="s15">60</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">overflow</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>handleDeparture</span><span class="s8">(</span><span class="s1">data</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy</span><span class="s8">--;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">warmupMin </span><span class="s8">*</span><span class="s1"> </span><span class="s15">60</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> wait </span><span class="s8">=</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">startService </span><span class="s8">-</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">arrivalTime</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalWaitTime </span><span class="s8">+=</span><span class="s1"> wait</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalSystemTime </span><span class="s8">+=</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">-</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">arrivalTime</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">wait </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0.001</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">waitCount</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> nextArr </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">shift</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">serversBusy</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">schedule</span><span class="s8">(</span><span class="s14">EVENTS</span><span class="s8">.</span><span class="s14">DEPARTURE</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">getServiceTime</span><span class="s8">(),</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> arrivalTime</span><span class="s8">:</span><span class="s1"> nextArr</span><span class="s8">,</span><span class="s1"> startService</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">currentTime </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>getServiceTime</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> st</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">serviceDist </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'fixed'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>st </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">dwellTime</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>st </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s15">1.0</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">dwellTime</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Store for validation check</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">serviceSample</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">5000</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">serviceSample</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">st</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s1"> st</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>computeFinalMetrics</span><span class="s8">(</span><span class="s1">warmup</span><span class="s8">,</span><span class="s1"> end</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> dur </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> end </span><span class="s8">-</span><span class="s1"> warmup</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s14">Lq</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalQueueTimeArea </span><span class="s8">/</span><span class="s1"> dur</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s14">Wq</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">totalWaitTime </span><span class="s8">/</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed </span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>utilization</span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">serverBusyTimeArea </span><span class="s8">/</span><span class="s1"> dur</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>probZeroQueue</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">zeroQueueTime </span><span class="s8">/</span><span class="s1"> dur</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>probWait</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">waitCount </span><span class="s8">/</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed </span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>throughput</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">completed </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dur</span><span class="s8">/</span><span class="s15">3600</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>overflows</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">stats</span><span class="s8">.</span><span class="s1">overflow</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>timeSeries</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>interArrivalSample</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>serviceSample</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">serviceSample</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>* 2. REAL-TIME VISUALIZER (Animation Loop)</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>* Handles vehicle movement and visualization on Canvas</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>*/</span></p>
<p class="p7"><span class="s12">class</span><span class="s4"> </span><span class="s1">VisualSimulation</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">constructor</span><span class="s8">(</span><span class="s1">canvas</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas </span><span class="s8">=</span><span class="s1"> canvas</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">ctx </span><span class="s8">=</span><span class="s1"> canvas</span><span class="s8">.</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Random</span><span class="s8">(</span><span class="s1">config</span><span class="s8">.</span><span class="s1">seed</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextArrival </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">lastFrameTime </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">speedFactor </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'speed-slider'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s15">5</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s15">20</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight </span><span class="s8">=</span><span class="s1"> </span><span class="s15">12</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Real-time Stats Tracking</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>totalSamples</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>samplesQGT0</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>utilizationCounts</span><span class="s8">:</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Array</span><span class="s8">(</span><span class="s1">config</span><span class="s8">.</span><span class="s1">servers </span><span class="s8">+</span><span class="s1"> </span><span class="s15">1</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">(</span><span class="s15">0</span><span class="s8">),</span><span class="s1"> </span><span class="s11">// Index = num busy</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>queueCounts</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{},</span><span class="s1"> </span><span class="s11">// Map size -&gt; count</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>waitTimes</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> </span><span class="s11">// Array of wait times</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>lastChartUpdate</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">};</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> rect </span><span class="s8">=</span><span class="s1"> canvas</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>canvas</span><span class="s8">.</span><span class="s1">width </span><span class="s8">=</span><span class="s1"> rect</span><span class="s8">.</span><span class="s1">width</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">=</span><span class="s1"> rect</span><span class="s8">.</span><span class="s1">height</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">initBays</span><span class="s8">();</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s4">initRealTimeCharts</span><span class="s8">();</span><span class="s4"> </span><span class="s1">// Initialize charts immediately</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextArrival </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s1">config</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">/</span><span class="s1"> </span><span class="s15">3600</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>initBays</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> s </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> w </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">width</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> h </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> roadH </span><span class="s8">=</span><span class="s1"> </span><span class="s15">60</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bayMargin </span><span class="s8">=</span><span class="s1"> </span><span class="s15">5</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> availW </span><span class="s8">=</span><span class="s1"> w </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> bayW </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">availW </span><span class="s8">/</span><span class="s1"> s</span><span class="s8">)</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> bayMargin</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">bayW </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">60</span><span class="s8">)</span><span class="s1"> bayW </span><span class="s8">=</span><span class="s1"> </span><span class="s15">60</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s15">5</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">min</span><span class="s8">(</span><span class="s15">20</span><span class="s8">,</span><span class="s1"> bayW </span><span class="s8">-</span><span class="s1"> </span><span class="s15">4</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> startX </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">w </span><span class="s8">-</span><span class="s1"> </span><span class="s8">(</span><span class="s1">s </span><span class="s8">*</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bayW </span><span class="s8">+</span><span class="s1"> bayMargin</span><span class="s8">)))</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bayY </span><span class="s8">=</span><span class="s1"> h </span><span class="s8">-</span><span class="s1"> roadH </span><span class="s8">-</span><span class="s1"> </span><span class="s15">80</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">for</span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i</span><span class="s8">=</span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">&lt;</span><span class="s1">s</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>id</span><span class="s8">:</span><span class="s1"> i</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>x</span><span class="s8">:</span><span class="s1"> startX </span><span class="s8">+</span><span class="s1"> i </span><span class="s8">*</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bayW </span><span class="s8">+</span><span class="s1"> bayMargin</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>y</span><span class="s8">:</span><span class="s1"> bayY</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>w</span><span class="s8">:</span><span class="s1"> bayW</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>h</span><span class="s8">:</span><span class="s1"> </span><span class="s15">50</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>occupiedBy</span><span class="s8">:</span><span class="s1"> </span><span class="s12">null</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>initRealTimeCharts</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Explicitly destroy existing charts on these canvases to avoid conflicts</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s4"> canvasIds </span><span class="s8">=</span><span class="s4"> </span><span class="s8">[</span><span class="s1">'chart-system'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'chart-queue'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'chart-wait-hist'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'chart-sweep'</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>canvasIds</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">id </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> chart </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">chart</span><span class="s8">)</span><span class="s1"> chart</span><span class="s8">.</span><span class="s1">destroy</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 1. Utilization Histogram (Replaces chart-system)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxUtil </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-system'</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-util'</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctxUtil</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'bar'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> </span><span class="s14">Array</span><span class="s8">.</span><span class="s12">from</span><span class="s8">({</span><span class="s1">length</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers </span><span class="s8">+</span><span class="s1"> </span><span class="s15">1</span><span class="s8">},</span><span class="s1"> </span><span class="s8">(</span><span class="s1">_</span><span class="s8">,</span><span class="s1"> i</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> i</span><span class="s8">.</span><span class="s1">toString</span><span class="s8">()),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Freq of Busy Servers'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Array</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers </span><span class="s8">+</span><span class="s1"> </span><span class="s15">1</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">(</span><span class="s15">0</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#059669'</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span><span class="s1"> animation</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Real-Time Utilization (Busy Count)'</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 2. Queue Length Histogram (Replaces chart-queue)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxQueue </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-queue'</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-queue'</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctxQueue</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'bar'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s10">'0'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'1'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'2'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'3'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'4'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'5+'</span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Freq of Queue Length'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#2563eb'</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span><span class="s1"> animation</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Real-Time Queue Length Distribution'</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 3. Wait Time Histogram (Replaces chart-wait-hist)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxWait </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-wait-hist'</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-wait'</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctxWait</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'bar'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s4"> </span><span class="s8">[</span><span class="s1">'0-10s'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'10-30s'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'30-60s'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'60s+'</span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Wait Time Count'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#7c3aed'</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span><span class="s1"> animation</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Real-Time Wait Time Distribution'</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 4. Prob(Q &gt; 0) (Replaces chart-sweep)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxProb </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-sweep'</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-prob'</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctxProb</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'doughnut'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s4"> </span><span class="s8">[</span><span class="s1">'Queue Empty (P=0)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Queue Active (P&gt;0)'</span><span class="s8">],</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">],</span><span class="s1"> </span><span class="s11">// Start with all empty</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s10">'#e5e7eb'</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#db2777'</span><span class="s8">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span><span class="s1"> animation</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Queue Activity (Prob Q&gt;0)'</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>start</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId</span><span class="s8">)</span><span class="s1"> cancelAnimationFrame</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">lastFrameTime </span><span class="s8">=</span><span class="s1"> performance</span><span class="s8">.</span><span class="s1">now</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">loop</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>stop</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId</span><span class="s8">)</span><span class="s1"> cancelAnimationFrame</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>loop</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> now </span><span class="s8">=</span><span class="s1"> performance</span><span class="s8">.</span><span class="s1">now</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> delta </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">now </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">lastFrameTime</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">1000</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">lastFrameTime </span><span class="s8">=</span><span class="s1"> now</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> simDelta </span><span class="s8">=</span><span class="s1"> delta </span><span class="s8">*</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">speedFactor</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">+=</span><span class="s1"> simDelta</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">update</span><span class="s8">(</span><span class="s1">simDelta</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">draw</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">sampleStats</span><span class="s8">(</span><span class="s1">simDelta</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// Sample statistics</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Update charts every 500ms real time</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">now </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">lastChartUpdate </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">500</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateRealTimeCharts</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">lastChartUpdate </span><span class="s8">=</span><span class="s1"> now</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">animationId </span><span class="s8">=</span><span class="s1"> requestAnimationFrame</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">loop</span><span class="s8">());</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> mins </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">floor</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">/</span><span class="s1"> </span><span class="s15">60</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> secs </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">floor</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">%</span><span class="s1"> </span><span class="s15">60</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'visual-time'</span><span class="s8">).</span><span class="s1">innerText </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">mins</span><span class="s8">.</span><span class="s1">toString</span><span class="s8">().</span><span class="s1">padStart</span><span class="s8">(</span><span class="s15">2</span><span class="s8">,</span><span class="s10">'0'</span><span class="s8">)}</span><span class="s10">:</span><span class="s8">${</span><span class="s1">secs</span><span class="s8">.</span><span class="s1">toString</span><span class="s8">().</span><span class="s1">padStart</span><span class="s8">(</span><span class="s15">2</span><span class="s8">,</span><span class="s10">'0'</span><span class="s8">)}</span><span class="s10">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>sampleStats</span><span class="s8">(</span><span class="s1">dt</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">totalSamples</span><span class="s8">++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 1. Utilization</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> busy </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">filter</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">occupiedBy</span><span class="s8">).</span><span class="s1">length</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">utilizationCounts</span><span class="s8">[</span><span class="s1">busy</span><span class="s8">]++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 2. Queue</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> qLen </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">qLen </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">samplesQGT0</span><span class="s8">++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">[</span><span class="s1">qLen</span><span class="s8">])</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">[</span><span class="s1">qLen</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">[</span><span class="s1">qLen</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>updateRealTimeCharts</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">charts</span><span class="s8">[</span><span class="s10">'rt-util'</span><span class="s8">])</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 1. Utilization Update</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-util'</span><span class="s8">].</span><span class="s1">data</span><span class="s8">.</span><span class="s1">datasets</span><span class="s8">[</span><span class="s15">0</span><span class="s8">].</span><span class="s1">data </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">utilizationCounts</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-util'</span><span class="s8">].</span><span class="s1">update</span><span class="s8">(</span><span class="s10">'none'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 2. Queue Update</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Bucket the queue counts into 0, 1, 2, 3, 4, 5+</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> qData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s14">Object</span><span class="s8">.</span><span class="s1">keys</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">k </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> idx </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">k</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">idx </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s15">5</span><span class="s8">)</span><span class="s1"> qData</span><span class="s8">[</span><span class="s15">5</span><span class="s8">]</span><span class="s1"> </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">[</span><span class="s1">k</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> qData</span><span class="s8">[</span><span class="s1">idx</span><span class="s8">]</span><span class="s1"> </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">queueCounts</span><span class="s8">[</span><span class="s1">k</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-queue'</span><span class="s8">].</span><span class="s1">data</span><span class="s8">.</span><span class="s1">datasets</span><span class="s8">[</span><span class="s15">0</span><span class="s8">].</span><span class="s1">data </span><span class="s8">=</span><span class="s1"> qData</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-queue'</span><span class="s8">].</span><span class="s1">update</span><span class="s8">(</span><span class="s10">'none'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 3. Wait Time Update</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Bin wait times: 0-10, 10-30, 30-60, 60+</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> wData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">waitTimes</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">w </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">w </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">10</span><span class="s8">)</span><span class="s1"> wData</span><span class="s8">[</span><span class="s15">0</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">w </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">30</span><span class="s8">)</span><span class="s1"> wData</span><span class="s8">[</span><span class="s15">1</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">w </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">60</span><span class="s8">)</span><span class="s1"> wData</span><span class="s8">[</span><span class="s15">2</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">else</span><span class="s1"> wData</span><span class="s8">[</span><span class="s15">3</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-wait'</span><span class="s8">].</span><span class="s1">data</span><span class="s8">.</span><span class="s1">datasets</span><span class="s8">[</span><span class="s15">0</span><span class="s8">].</span><span class="s1">data </span><span class="s8">=</span><span class="s1"> wData</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-wait'</span><span class="s8">].</span><span class="s1">update</span><span class="s8">(</span><span class="s10">'none'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 4. Prob(Q&gt;0) Update</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> pActive </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">samplesQGT0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> pEmpty </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">totalSamples </span><span class="s8">-</span><span class="s1"> pActive</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-prob'</span><span class="s8">].</span><span class="s1">data</span><span class="s8">.</span><span class="s1">datasets</span><span class="s8">[</span><span class="s15">0</span><span class="s8">].</span><span class="s1">data </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span><span class="s1">pEmpty</span><span class="s8">,</span><span class="s1"> pActive</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'rt-prob'</span><span class="s8">].</span><span class="s1">update</span><span class="s8">(</span><span class="s10">'none'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Helper to start a smooth move</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>setTarget</span><span class="s8">(</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> x</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">,</span><span class="s1"> duration</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Only reset animation if target changes significantly</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s14">Math</span><span class="s8">.</span><span class="s1">abs</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">targetX </span><span class="s8">-</span><span class="s1"> x</span><span class="s8">)</span><span class="s1"> </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">1</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">abs</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">targetY </span><span class="s8">-</span><span class="s1"> y</span><span class="s8">)</span><span class="s1"> </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">startX </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">startY </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">targetX </span><span class="s8">=</span><span class="s1"> x</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">targetY </span><span class="s8">=</span><span class="s1"> y</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">moveDuration </span><span class="s8">=</span><span class="s1"> duration </span><span class="s8">||</span><span class="s1"> </span><span class="s15">1.0</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// sim seconds</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">startMoveTime </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>update</span><span class="s8">(</span><span class="s1">dt</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 1. Generate Arrivals</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextArrival</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">spawnVehicle</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> rate </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">/</span><span class="s1"> </span><span class="s15">3600</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">nextArrival </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s1">rate</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 2. Logic: Move Queue to Bay</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> freeBay </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">===</span><span class="s1"> </span><span class="s12">null</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">freeBay</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> veh </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">shift</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateQueuePositions</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Track Wait Time</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> waitTime </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">-</span><span class="s1"> veh</span><span class="s8">.</span><span class="s1">queueStartTime</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">rtStats</span><span class="s8">.</span><span class="s1">waitTimes</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">waitTime</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>veh</span><span class="s8">.</span><span class="s1">state </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'MOVING_TO_BAY'</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> tx </span><span class="s8">=</span><span class="s1"> freeBay</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">freeBay</span><span class="s8">.</span><span class="s1">w </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ty </span><span class="s8">=</span><span class="s1"> freeBay</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">freeBay</span><span class="s8">.</span><span class="s1">h </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">setTarget</span><span class="s8">(</span><span class="s1">veh</span><span class="s8">,</span><span class="s1"> tx</span><span class="s8">,</span><span class="s1"> ty</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2.0</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// 2 sim seconds to park</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>veh</span><span class="s8">.</span><span class="s1">bayId </span><span class="s8">=</span><span class="s1"> freeBay</span><span class="s8">.</span><span class="s1">id</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>freeBay</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">=</span><span class="s1"> veh</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> svcTime </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">serviceDist </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'fixed'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">dwellTime </span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">rng</span><span class="s8">.</span><span class="s1">exponential</span><span class="s8">(</span><span class="s15">1.0</span><span class="s8">/</span><span class="s12">this</span><span class="s8">.</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">dwellTime</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>veh</span><span class="s8">.</span><span class="s1">dwellDuration </span><span class="s8">=</span><span class="s1"> svcTime</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 3. Update Vehicles</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">for</span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles</span><span class="s8">.</span><span class="s1">length </span><span class="s8">-</span><span class="s1"> </span><span class="s15">1</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">--)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> v </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles</span><span class="s8">[</span><span class="s1">i</span><span class="s8">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Calculate Tween Progress</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> progress </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">moveDuration </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>progress </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">-</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">startMoveTime</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">moveDuration</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>progress </span><span class="s8">=</span><span class="s1"> </span><span class="s15">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">progress </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s15">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s11">// Arrived</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">targetX</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">targetY</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'SPAWNING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'QUEUED'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateQueuePositions</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'MOVING_TO_BAY'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'DWELLING'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">serviceEnd </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">+</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">dwellDuration</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'EXITING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s11">// Fully left</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bay </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">bayId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bay </span><span class="s8">&amp;&amp;</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">===</span><span class="s1"> v</span><span class="s8">)</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles</span><span class="s8">.</span><span class="s1">splice</span><span class="s8">(</span><span class="s1">i</span><span class="s8">,</span><span class="s1"> </span><span class="s15">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">continue</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Skip rest of loop</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Interpolate (Ease In Out Quad)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> t </span><span class="s8">=</span><span class="s1"> progress </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">0.5</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s15">2</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> progress </span><span class="s8">*</span><span class="s1"> progress </span><span class="s8">:</span><span class="s1"> </span><span class="s15">1</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">pow</span><span class="s8">(-</span><span class="s15">2</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> progress </span><span class="s8">+</span><span class="s1"> </span><span class="s15">2</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">startX </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">targetX </span><span class="s8">-</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">startX</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> t</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">startY </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">targetY </span><span class="s8">-</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">startY</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> t</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Clearance Check for EXITING vehicles</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'EXITING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bay </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">bayId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bay </span><span class="s8">&amp;&amp;</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">===</span><span class="s1"> v</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s11">// AABB Check</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> carRect </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> l</span><span class="s8">:</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> r</span><span class="s8">:</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth</span><span class="s8">,</span><span class="s1"> t</span><span class="s8">:</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">:</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bayRect </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> l</span><span class="s8">:</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> r</span><span class="s8">:</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">w</span><span class="s8">,</span><span class="s1"> t</span><span class="s8">:</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">:</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">h </span><span class="s8">};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> isOverlapping </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">carRect</span><span class="s8">.</span><span class="s1">l </span><span class="s8">&lt;</span><span class="s1"> bayRect</span><span class="s8">.</span><span class="s1">r </span><span class="s8">&amp;&amp;</span><span class="s1"> carRect</span><span class="s8">.</span><span class="s1">r </span><span class="s8">&gt;</span><span class="s1"> bayRect</span><span class="s8">.</span><span class="s1">l </span><span class="s8">&amp;&amp;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>carRect</span><span class="s8">.</span><span class="s1">t </span><span class="s8">&lt;</span><span class="s1"> bayRect</span><span class="s8">.</span><span class="s1">b </span><span class="s8">&amp;&amp;</span><span class="s1"> carRect</span><span class="s8">.</span><span class="s1">b </span><span class="s8">&gt;</span><span class="s1"> bayRect</span><span class="s8">.</span><span class="s1">t</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isOverlapping</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>bay</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Dwell Logic</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'DWELLING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s11">// Force Center</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bay </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">bayId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">bay</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">=</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bay</span><span class="s8">.</span><span class="s1">w </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">=</span><span class="s1"> bay</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">bay</span><span class="s8">.</span><span class="s1">h </span><span class="s8">-</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">serviceEnd </span><span class="s8">&amp;&amp;</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime </span><span class="s8">&gt;=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">serviceEnd</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'EXITING'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> exitX </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">width </span><span class="s8">+</span><span class="s1"> </span><span class="s15">50</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> exitY </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">30</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Calculate duration based on distance to keep speed roughly constant or fixed time</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Fixed time is smoother for animation flow</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">setTarget</span><span class="s8">(</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> exitX</span><span class="s8">,</span><span class="s1"> exitY</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2.0</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>spawnVehicle</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> v </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>id</span><span class="s8">:</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">random</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>x</span><span class="s8">:</span><span class="s1"> </span><span class="s8">-</span><span class="s15">40</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>y</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>startX</span><span class="s8">:</span><span class="s1"> </span><span class="s8">-</span><span class="s15">40</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>startY</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>targetX</span><span class="s8">:</span><span class="s4"> </span><span class="s8">-</span><span class="s15">40</span><span class="s8">,</span><span class="s4"> </span><span class="s1">// Will be updated by updateQueuePositions</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>targetY</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>startMoveTime</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>moveDuration</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>state</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'SPAWNING'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>queueStartTime</span><span class="s8">:</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">simTime</span><span class="s8">,</span><span class="s1"> </span><span class="s11">// Track start time for wait calc</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>bayId</span><span class="s8">:</span><span class="s1"> </span><span class="s8">-</span><span class="s15">1</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>color</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#fbbf24'</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">v</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">v</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">updateQueuePositions</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>updateQueuePositions</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> queueStartX </span><span class="s8">=</span><span class="s1"> </span><span class="s15">20</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> gap </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">+</span><span class="s1"> </span><span class="s15">8</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Slightly larger gap</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> firstBayX </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">[</span><span class="s15">0</span><span class="s8">]</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">[</span><span class="s15">0</span><span class="s8">].</span><span class="s1">x </span><span class="s8">:</span><span class="s1"> </span><span class="s15">100</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> safeWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s15">50</span><span class="s8">,</span><span class="s1"> firstBayX </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> maxPerLine </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">floor</span><span class="s8">(</span><span class="s1">safeWidth </span><span class="s8">/</span><span class="s1"> gap</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> effectiveMaxPerLine </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> maxPerLine</span><span class="s8">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s4"> </span><span class="s1">MAX_VISUAL_QUEUE</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s15">25</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> idx</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">idx </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s14">MAX_VISUAL_QUEUE</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// If capped, just set target offscreen</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">setTarget</span><span class="s8">(</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> </span><span class="s8">-</span><span class="s15">100</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0.5</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'SPAWNING'</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'QUEUED'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> line </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">floor</span><span class="s8">(</span><span class="s1">idx </span><span class="s8">/</span><span class="s1"> effectiveMaxPerLine</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> posInLine </span><span class="s8">=</span><span class="s1"> idx </span><span class="s8">%</span><span class="s1"> effectiveMaxPerLine</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> tx </span><span class="s8">=</span><span class="s1"> queueStartX </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">posInLine </span><span class="s8">*</span><span class="s1"> gap</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ty </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> </span><span class="s15">40</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> </span><span class="s8">(</span><span class="s1">line </span><span class="s8">*</span><span class="s1"> </span><span class="s15">18</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// If just spawning, set target immediately</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'SPAWNING'</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">targetX </span><span class="s8">===</span><span class="s1"> </span><span class="s8">-</span><span class="s15">40</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">setTarget</span><span class="s8">(</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> tx</span><span class="s8">,</span><span class="s1"> ty</span><span class="s8">,</span><span class="s1"> </span><span class="s15">1.0</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// 1s to enter queue</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Shuffle in queue (faster)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">setTarget</span><span class="s8">(</span><span class="s1">v</span><span class="s8">,</span><span class="s1"> tx</span><span class="s8">,</span><span class="s1"> ty</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0.5</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>draw</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctx </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">ctx</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> w </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">width</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> h </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">canvas</span><span class="s8">.</span><span class="s1">height</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 1. Background (Gradient)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bgGrad </span><span class="s8">=</span><span class="s1"> ctx</span><span class="s8">.</span><span class="s1">createLinearGradient</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>bgGrad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#0f172a'</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// Slate 900</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>bgGrad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#1e1b4b'</span><span class="s8">);</span><span class="s1"> </span><span class="s11">// Indigo 950</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> bgGrad</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillRect</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s15">0</span><span class="s8">,</span><span class="s1">w</span><span class="s8">,</span><span class="s1">h</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 2. Road</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#1e293b'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Slate 800</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillRect</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> h </span><span class="s8">-</span><span class="s1"> </span><span class="s15">60</span><span class="s8">,</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> </span><span class="s15">60</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Road Markings</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">strokeStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#fbbf24'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Amber 400</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">setLineDash</span><span class="s8">([</span><span class="s15">20</span><span class="s8">,</span><span class="s1"> </span><span class="s15">30</span><span class="s8">]);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">beginPath</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">moveTo</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">-</span><span class="s15">30</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">w</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">-</span><span class="s15">30</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">stroke</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">setLineDash</span><span class="s8">([]);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Road Border (Top)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">beginPath</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">strokeStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#475569'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s15">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">moveTo</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">-</span><span class="s15">60</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">w</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">-</span><span class="s15">60</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">stroke</span><span class="s8">();</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 3. Bays</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">bays</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">b </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Bay Glow/Fill</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">b</span><span class="s8">.</span><span class="s1">occupiedBy</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'rgba(99, 102, 241, 0.2)'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Indigo 500 low opacity</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">shadowColor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#6366f1'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">shadowBlur </span><span class="s8">=</span><span class="s1"> </span><span class="s15">10</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'rgba(30, 41, 59, 0.5)'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Slate 800</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">shadowBlur </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Draw Rounded Rect for Bay</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">roundRect</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">w</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">h</span><span class="s8">,</span><span class="s1"> </span><span class="s15">5</span><span class="s8">,</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> </span><span class="s12">false</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">shadowBlur </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Reset</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Bay Border</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">strokeStyle </span><span class="s8">=</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">occupiedBy </span><span class="s8">?</span><span class="s1"> </span><span class="s10">'#818cf8'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#475569'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">roundRect</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">w</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">h</span><span class="s8">,</span><span class="s1"> </span><span class="s15">5</span><span class="s8">,</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span><span class="s1"> </span><span class="s12">true</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s11">// Label</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#94a3b8'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Slate 400</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">font </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'10px sans-serif'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> text </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`B</span><span class="s8">${</span><span class="s1">b</span><span class="s8">.</span><span class="s1">id</span><span class="s8">+</span><span class="s15">1</span><span class="s8">}</span><span class="s10">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> textW </span><span class="s8">=</span><span class="s1"> ctx</span><span class="s8">.</span><span class="s1">measureText</span><span class="s8">(</span><span class="s1">text</span><span class="s8">).</span><span class="s1">width</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillText</span><span class="s8">(</span><span class="s1">text</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s1">b</span><span class="s8">.</span><span class="s1">w </span><span class="s8">-</span><span class="s1"> textW</span><span class="s8">)/</span><span class="s15">2</span><span class="s8">,</span><span class="s1"> b</span><span class="s8">.</span><span class="s1">y </span><span class="s8">-</span><span class="s1"> </span><span class="s15">6</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 4. Vehicles</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">vehicles</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">v </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s8">-</span><span class="s15">30</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Gradient based on state</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> grad </span><span class="s8">=</span><span class="s1"> ctx</span><span class="s8">.</span><span class="s1">createLinearGradient</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'MOVING_TO_BAY'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Moving: Cyan/Blue</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#22d3ee'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#0ea5e9'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'DWELLING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Parked: Violet/Purple</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#c084fc'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#7c3aed'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'EXITING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Exiting: Emerald/Teal</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#34d399'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#059669'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Queue: Amber/Orange</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#fbbf24'</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>grad</span><span class="s8">.</span><span class="s1">addColorStop</span><span class="s8">(</span><span class="s15">1</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'#d97706'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> grad</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Draw Car Body (Rounded)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">this</span><span class="s8">.</span><span class="s1">roundRect</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight</span><span class="s8">,</span><span class="s1"> </span><span class="s15">3</span><span class="s8">,</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> </span><span class="s12">false</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Roof / Details</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">8</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'rgba(255,255,255,0.2)'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> roofW </span><span class="s8">=</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">*</span><span class="s1"> </span><span class="s15">0.5</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> roofX </span><span class="s8">=</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">-</span><span class="s1"> roofW</span><span class="s8">)/</span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillRect</span><span class="s8">(</span><span class="s1">roofX</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s15">2</span><span class="s8">,</span><span class="s1"> roofW</span><span class="s8">,</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight </span><span class="s8">-</span><span class="s1"> </span><span class="s15">4</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Headlights (Yellow dots) if moving right</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">state </span><span class="s8">!==</span><span class="s1"> </span><span class="s10">'DWELLING'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#fef08a'</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Yellow 200</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">beginPath</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">arc</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">-</span><span class="s1"> </span><span class="s15">1</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s15">3</span><span class="s8">,</span><span class="s1"> </span><span class="s15">1.5</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s14">PI</span><span class="s8">*</span><span class="s15">2</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">arc</span><span class="s8">(</span><span class="s1">v</span><span class="s8">.</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carWidth </span><span class="s8">-</span><span class="s1"> </span><span class="s15">1</span><span class="s8">,</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">y </span><span class="s8">+</span><span class="s1"> </span><span class="s12">this</span><span class="s8">.</span><span class="s1">carHeight </span><span class="s8">-</span><span class="s1"> </span><span class="s15">3</span><span class="s8">,</span><span class="s1"> </span><span class="s15">1.5</span><span class="s8">,</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s14">PI</span><span class="s8">*</span><span class="s15">2</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fill</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// 5. Queue Stats</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillStyle </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'#e2e8f0'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">font </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'12px sans-serif'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">fillText</span><span class="s8">(</span><span class="s10">`Queue: </span><span class="s8">${</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length</span><span class="s8">}${</span><span class="s12">this</span><span class="s8">.</span><span class="s1">queue</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">25</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s10">' (Visually Capped)'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s10">''</span><span class="s8">}</span><span class="s10">`</span><span class="s8">,</span><span class="s1"> </span><span class="s15">10</span><span class="s8">,</span><span class="s1"> h </span><span class="s8">-</span><span class="s1"> </span><span class="s15">70</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Helper for rounded rectangles</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>roundRect</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> x</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">,</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> h</span><span class="s8">,</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> fill</span><span class="s8">,</span><span class="s1"> stroke</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">beginPath</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">moveTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> w </span><span class="s8">-</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">quadraticCurveTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">,</span><span class="s1"> x </span><span class="s8">+</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> r</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h </span><span class="s8">-</span><span class="s1"> r</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">quadraticCurveTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> w</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h</span><span class="s8">,</span><span class="s1"> x </span><span class="s8">+</span><span class="s1"> w </span><span class="s8">-</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">x </span><span class="s8">+</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">quadraticCurveTo</span><span class="s8">(</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h</span><span class="s8">,</span><span class="s1"> x</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> h </span><span class="s8">-</span><span class="s1"> r</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">lineTo</span><span class="s8">(</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> y </span><span class="s8">+</span><span class="s1"> r</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">quadraticCurveTo</span><span class="s8">(</span><span class="s1">x</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">,</span><span class="s1"> x </span><span class="s8">+</span><span class="s1"> r</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx</span><span class="s8">.</span><span class="s1">closePath</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">fill</span><span class="s8">)</span><span class="s1"> ctx</span><span class="s8">.</span><span class="s1">fill</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">stroke</span><span class="s8">)</span><span class="s1"> ctx</span><span class="s8">.</span><span class="s1">stroke</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>* UI CONTROLLERS &amp; SHARED LOGIC</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">Â </span>*/</span></p>
<p class="p4"><span class="s12">let</span><span class="s1"> charts </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s12">let</span><span class="s1"> lastResults </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s12">let</span><span class="s1"> visualSim </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> getConfig</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">return</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>arrivalRate</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'arrival_rate'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>dwellTime</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'dwell_time'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>serviceDist</span><span class="s8">:</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'service_dist'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>servers</span><span class="s8">:</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'num_bays'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>queueCap</span><span class="s8">:</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'queue_cap'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>durationMin</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'duration_min'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>warmupMin</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'warmup_min'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>seed</span><span class="s8">:</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'seed'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>timeStep</span><span class="s8">:</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'time_step'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">};</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">// ---- VISUAL SIMULATION CONTROL ----</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> toggleVisualSimulation</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> visualWrapper </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'visual-container'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> btn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'btn-visual'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> isVisible </span><span class="s8">=</span><span class="s1"> </span><span class="s8">!</span><span class="s1">visualWrapper</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isVisible</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s11">// Stop</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">visualSim</span><span class="s8">)</span><span class="s1"> visualSim</span><span class="s8">.</span><span class="s1">stop</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>visualWrapper</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;span&gt;ğŸ‘ï¸&lt;/span&gt; &amp;nbsp; Live Visualization'</span><span class="s8">;</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">remove</span><span class="s8">(</span><span class="s1">'bg-red-600'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'hover:bg-red-700'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'btn-visual'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s11">// Start</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>visualWrapper</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;span&gt;â¹&lt;/span&gt; &amp;nbsp; Stop Visualization'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'btn-visual'</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>btn</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">add</span><span class="s8">(</span><span class="s1">'bg-red-600'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'hover:bg-red-700'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Init logic</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> config </span><span class="s8">=</span><span class="s1"> getConfig</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> canvas </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'visual-canvas'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">visualSim</span><span class="s8">)</span><span class="s1"> visualSim</span><span class="s8">.</span><span class="s1">stop</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>visualSim </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">VisualSimulation</span><span class="s8">(</span><span class="s1">canvas</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>visualSim</span><span class="s8">.</span><span class="s1">start</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">// Add Speed Slider Listener</span></p>
<p class="p4"><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'speed-slider'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'input'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> val </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">value</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'speed-label'</span><span class="s8">).</span><span class="s1">innerText </span><span class="s8">=</span><span class="s1"> val </span><span class="s8">+</span><span class="s1"> </span><span class="s10">'x'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">visualSim</span><span class="s8">)</span><span class="s1"> visualSim</span><span class="s8">.</span><span class="s1">speedFactor </span><span class="s8">=</span><span class="s1"> val</span><span class="s8">;</span></p>
<p class="p9"><span class="s1">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">// ---- FAST STATS SIMULATION ----</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> runSingleSimulation</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s10">"Running..."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> config </span><span class="s8">=</span><span class="s1"> getConfig</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> sim </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Simulation</span><span class="s8">(</span><span class="s1">config</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> results </span><span class="s8">=</span><span class="s1"> sim</span><span class="s8">.</span><span class="s1">run</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>lastResults </span><span class="s8">=</span><span class="s1"> results</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderMetrics</span><span class="s8">(</span><span class="s1">results</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderValidation</span><span class="s8">(</span><span class="s1">results</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderCharts</span><span class="s8">(</span><span class="s1">results</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s1">"Simulation Complete"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s1"> </span><span class="s15">10</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> runBatchSimulation</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> iterations </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'batch_runs'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s15">50</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s10">`Running Batch (</span><span class="s8">${</span><span class="s1">iterations</span><span class="s8">}</span><span class="s10">)...`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> config </span><span class="s8">=</span><span class="s1"> getConfig</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> agg </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s14">Lq</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Wq</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> util</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> probZero</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span><span class="s1"> probWait</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">};</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">for</span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i</span><span class="s8">=</span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">&lt;</span><span class="s1">iterations</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>config</span><span class="s8">.</span><span class="s1">seed </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">seed </span><span class="s8">+</span><span class="s1"> i</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> sim </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Simulation</span><span class="s8">(</span><span class="s1">config</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> res </span><span class="s8">=</span><span class="s1"> sim</span><span class="s8">.</span><span class="s1">run</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>agg</span><span class="s8">.</span><span class="s14">Lq</span><span class="s1"> </span><span class="s8">+=</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Lq</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>agg</span><span class="s8">.</span><span class="s14">Wq</span><span class="s1"> </span><span class="s8">+=</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Wq</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>agg</span><span class="s8">.</span><span class="s1">util </span><span class="s8">+=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">utilization</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>agg</span><span class="s8">.</span><span class="s1">probZero </span><span class="s8">+=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">probZeroQueue</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>agg</span><span class="s8">.</span><span class="s1">probWait </span><span class="s8">+=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">probWait</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// Aggregating probWait</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> avg </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s14">Lq</span><span class="s8">:</span><span class="s1"> agg</span><span class="s8">.</span><span class="s14">Lq</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> iterations</span><span class="s8">,</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s14">Wq</span><span class="s8">:</span><span class="s1"> agg</span><span class="s8">.</span><span class="s14">Wq</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> iterations</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>utilization</span><span class="s8">:</span><span class="s1"> agg</span><span class="s8">.</span><span class="s1">util </span><span class="s8">/</span><span class="s1"> iterations</span><span class="s8">,</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>probZeroQueue</span><span class="s8">:</span><span class="s1"> agg</span><span class="s8">.</span><span class="s1">probZero </span><span class="s8">/</span><span class="s1"> iterations</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>probWait</span><span class="s8">:</span><span class="s1"> agg</span><span class="s8">.</span><span class="s1">probWait </span><span class="s8">/</span><span class="s1"> iterations</span><span class="s8">,</span><span class="s1"> </span><span class="s11">// Calculating average probWait</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>throughput</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"N/A"</span><span class="s8">,</span><span class="s1"> overflows</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"N/A"</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderMetrics</span><span class="s8">(</span><span class="s1">avg</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderValidation</span><span class="s8">(</span><span class="s1">avg</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">);</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>clearCharts</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s10">`Batch Complete (</span><span class="s8">${</span><span class="s1">iterations</span><span class="s8">}</span><span class="s10"> runs)`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s1"> </span><span class="s15">50</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> runScenarioSweep</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s1">"Running Sweep..."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> config </span><span class="s8">=</span><span class="s1"> getConfig</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> baseLambda </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">arrivalRate</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> steps </span><span class="s8">=</span><span class="s1"> </span><span class="s15">10</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> maxLambda </span><span class="s8">=</span><span class="s1"> baseLambda </span><span class="s8">*</span><span class="s1"> </span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> dataPoints </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">for</span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i</span><span class="s8">=</span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">&lt;=</span><span class="s1">steps</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> lambda </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">maxLambda </span><span class="s8">/</span><span class="s1"> steps</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> i</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">lambda </span><span class="s8">===</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> lambda </span><span class="s8">=</span><span class="s1"> </span><span class="s15">10</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>config</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">=</span><span class="s1"> lambda</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>config</span><span class="s8">.</span><span class="s1">seed </span><span class="s8">=</span><span class="s1"> </span><span class="s15">12345</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> sim </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Simulation</span><span class="s8">(</span><span class="s1">config</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> res </span><span class="s8">=</span><span class="s1"> sim</span><span class="s8">.</span><span class="s1">run</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dataPoints</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> x</span><span class="s8">:</span><span class="s1"> lambda</span><span class="s8">,</span><span class="s1"> y</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Wq</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderSweepChart</span><span class="s8">(</span><span class="s1">dataPoints</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>config</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">=</span><span class="s1"> baseLambda</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space">Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateStatus</span><span class="s8">(</span><span class="s10">"Sweep Complete"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s1"> </span><span class="s15">50</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> updateStatus</span><span class="s8">(</span><span class="s1">msg</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> el </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'status-msg'</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>el</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> msg </span><span class="s8">?</span><span class="s4"> </span><span class="s1">`&lt;span class="loader"&gt;&lt;/span&gt; </span><span class="s8">${</span><span class="s4">msg</span><span class="s8">}</span><span class="s1">`</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">msg </span><span class="s8">&amp;&amp;</span><span class="s1"> </span><span class="s8">!</span><span class="s1">msg</span><span class="s8">.</span><span class="s1">includes</span><span class="s8">(</span><span class="s10">'Running'</span><span class="s8">))</span><span class="s1"> setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> el</span><span class="s8">.</span><span class="s1">innerText </span><span class="s8">=</span><span class="s1"> msg</span><span class="s8">,</span><span class="s1"> </span><span class="s15">500</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">// ---- THEORETICAL CALCS ----</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> factorial</span><span class="s8">(</span><span class="s1">n</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s12">return</span><span class="s1"> n </span><span class="s8">===</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s15">1</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> n </span><span class="s8">*</span><span class="s1"> factorial</span><span class="s8">(</span><span class="s1">n</span><span class="s8">-</span><span class="s15">1</span><span class="s8">);</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> calculateTheory</span><span class="s8">(</span><span class="s1">lambda</span><span class="s8">,</span><span class="s1"> mu</span><span class="s8">,</span><span class="s1"> s</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> rho </span><span class="s8">=</span><span class="s1"> lambda </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">s </span><span class="s8">*</span><span class="s1"> mu</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> intensity </span><span class="s8">=</span><span class="s1"> lambda </span><span class="s8">/</span><span class="s1"> mu</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">rho </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s15">1</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> rho</span><span class="s8">,</span><span class="s1"> stable</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">let</span><span class="s1"> sum </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">for</span><span class="s1"> </span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i </span><span class="s8">&lt;</span><span class="s1"> s</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> sum </span><span class="s8">+=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">pow</span><span class="s8">(</span><span class="s1">intensity</span><span class="s8">,</span><span class="s1"> i</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> factorial</span><span class="s8">(</span><span class="s1">i</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> termS </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s14">Math</span><span class="s8">.</span><span class="s1">pow</span><span class="s8">(</span><span class="s1">intensity</span><span class="s8">,</span><span class="s1"> s</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> factorial</span><span class="s8">(</span><span class="s1">s</span><span class="s8">))</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s8">(</span><span class="s15">1</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s15">1</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> rho</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> </span><span class="s14">P0</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s15">1</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">sum </span><span class="s8">+</span><span class="s1"> termS</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> </span><span class="s14">Lq</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s14">P0</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">pow</span><span class="s8">(</span><span class="s1">intensity</span><span class="s8">,</span><span class="s1"> s</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> rho</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">factorial</span><span class="s8">(</span><span class="s1">s</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">pow</span><span class="s8">(</span><span class="s15">1</span><span class="s1"> </span><span class="s8">-</span><span class="s1"> rho</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> rho</span><span class="s8">,</span><span class="s1"> stable</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> </span><span class="s14">P0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Pw</span><span class="s8">:</span><span class="s1"> termS </span><span class="s8">*</span><span class="s1"> </span><span class="s14">P0</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Lq</span><span class="s8">,</span><span class="s1"> </span><span class="s14">Wq</span><span class="s8">:</span><span class="s1"> </span><span class="s14">Lq</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> lambda</span><span class="s8">,</span><span class="s1"> utilization</span><span class="s8">:</span><span class="s1"> rho </span><span class="s8">};</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s1">// ---- CHART HELPERS ----</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> calculateHistogram</span><span class="s8">(</span><span class="s1">data</span><span class="s8">,</span><span class="s1"> binSize</span><span class="s8">,</span><span class="s1"> maxVal</span><span class="s8">,</span><span class="s1"> lambda</span><span class="s8">,</span><span class="s1"> count</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s8">(!</span><span class="s1">data </span><span class="s8">||</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> labels</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> counts</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> theory</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[]</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> max </span><span class="s8">=</span><span class="s1"> maxVal </span><span class="s8">||</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(...</span><span class="s1">data</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> bins </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">ceil</span><span class="s8">(</span><span class="s1">max </span><span class="s8">/</span><span class="s1"> binSize</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s15">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> labels </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> counts </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Array</span><span class="s8">(</span><span class="s1">bins</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">(</span><span class="s15">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> theory </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Bin Data</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>data</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">v </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> bin </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">floor</span><span class="s8">(</span><span class="s1">v </span><span class="s8">/</span><span class="s1"> binSize</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">bin </span><span class="s8">&lt;</span><span class="s1"> bins</span><span class="s8">)</span><span class="s1"> counts</span><span class="s8">[</span><span class="s1">bin</span><span class="s8">]++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Generate Labels and Theoretical Curve</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">for</span><span class="s8">(</span><span class="s12">let</span><span class="s1"> i</span><span class="s8">=</span><span class="s15">0</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">&lt;</span><span class="s1">bins</span><span class="s8">;</span><span class="s1"> i</span><span class="s8">++)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> x </span><span class="s8">=</span><span class="s1"> i </span><span class="s8">*</span><span class="s1"> binSize</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>labels</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">x</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Theoretical Exponential PDF: lambda * e^(-lambda * x)</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s1">// Expected count = N * PDF(x) * binWidth</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">lambda</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s1">// Using midpoint for better fit</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> mid </span><span class="s8">=</span><span class="s1"> x </span><span class="s8">+</span><span class="s1"> binSize</span><span class="s8">/</span><span class="s15">2</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> prob </span><span class="s8">=</span><span class="s1"> lambda </span><span class="s8">*</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">exp</span><span class="s8">(-</span><span class="s1">lambda </span><span class="s8">*</span><span class="s1"> mid</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>theory</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">prob </span><span class="s8">*</span><span class="s1"> binSize </span><span class="s8">*</span><span class="s1"> count</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> labels</span><span class="s8">,</span><span class="s1"> counts</span><span class="s8">,</span><span class="s1"> theory </span><span class="s8">};</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> renderDistributionCharts</span><span class="s8">(</span><span class="s1">res</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> lambda </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">/</span><span class="s1"> </span><span class="s15">3600</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// rate per sec</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> mu </span><span class="s8">=</span><span class="s1"> </span><span class="s15">1.0</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">dwellTime</span><span class="s8">;</span><span class="s1"> </span><span class="s11">// rate per sec</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Inter-Arrivals</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> iaData </span><span class="s8">=</span><span class="s1"> calculateHistogram</span><span class="s8">(</span><span class="s1">res</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2</span><span class="s8">,</span><span class="s1"> </span><span class="s15">60</span><span class="s8">,</span><span class="s1"> lambda</span><span class="s8">,</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">interArrivalSample</span><span class="s8">.</span><span class="s1">length</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>createMixedChart</span><span class="s8">(</span><span class="s1">'chart-arrival-dist'</span><span class="s8">,</span><span class="s4"> iaData</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Inter-Arrival Time (s)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Count'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Simulated'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Theoretical Exp'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Service Times</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Note: if fixed distribution, theory is a spike, but calculating exp curve anyway if exponential selected</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> svcDist </span><span class="s8">=</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">serviceDist </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'exponential'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> mu </span><span class="s8">:</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> svcData </span><span class="s8">=</span><span class="s1"> calculateHistogram</span><span class="s8">(</span><span class="s1">res</span><span class="s8">.</span><span class="s1">serviceSample</span><span class="s8">,</span><span class="s1"> </span><span class="s15">2</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">.</span><span class="s1">dwellTime </span><span class="s8">*</span><span class="s1"> </span><span class="s15">4</span><span class="s8">,</span><span class="s1"> svcDist</span><span class="s8">,</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">serviceSample</span><span class="s8">.</span><span class="s1">length</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>createMixedChart</span><span class="s8">(</span><span class="s1">'chart-service-dist'</span><span class="s8">,</span><span class="s4"> svcData</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Service Time (s)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Count'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Simulated'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Theoretical Exp'</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> createMixedChart</span><span class="s8">(</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">,</span><span class="s1"> xLabel</span><span class="s8">,</span><span class="s1"> yLabel</span><span class="s8">,</span><span class="s1"> barLabel</span><span class="s8">,</span><span class="s1"> lineLabel</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> existing </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">existing</span><span class="s8">)</span><span class="s1"> existing</span><span class="s8">.</span><span class="s1">destroy</span><span class="s8">();</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctx </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s1">id</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>charts</span><span class="s8">[</span><span class="s1">id</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">labels</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'line'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>label</span><span class="s8">:</span><span class="s1"> lineLabel</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">theory</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>borderColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#dc2626'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>borderWidth</span><span class="s8">:</span><span class="s1"> </span><span class="s15">2</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>pointRadius</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tension</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0.4</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'bar'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>label</span><span class="s8">:</span><span class="s1"> barLabel</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">counts</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'rgba(59, 130, 246, 0.5)'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>barPercentage</span><span class="s8">:</span><span class="s1"> </span><span class="s15">1.0</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>categoryPercentage</span><span class="s8">:</span><span class="s1"> </span><span class="s15">1.0</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> xLabel </span><span class="s8">}</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>scales</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>x</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> xLabel </span><span class="s8">}</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>y</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> yLabel </span><span class="s8">},</span><span class="s1"> beginAtZero</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">});</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> renderMetrics</span><span class="s8">(</span><span class="s1">res</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> panel </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'metrics-panel'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> cards </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Utilization"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s1">res</span><span class="s8">.</span><span class="s1">utilization </span><span class="s8">*</span><span class="s1"> </span><span class="s15">100</span><span class="s8">).</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s10">"%"</span><span class="s8">,</span><span class="s1"> color</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">utilization </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0.95</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s10">"text-red-600"</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s10">"text-gray-800"</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Avg Queue (Lq)"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Lq</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">2</span><span class="s8">),</span><span class="s1"> unit</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"veh"</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Avg Wait (Wq)"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Wq</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">),</span><span class="s1"> unit</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"s"</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Prob(Queue=0)"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> </span><span class="s8">(</span><span class="s1">res</span><span class="s8">.</span><span class="s1">probZeroQueue </span><span class="s8">*</span><span class="s1"> </span><span class="s15">100</span><span class="s8">).</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s10">"%"</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Throughput"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> </span><span class="s12">typeof</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">throughput </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'number'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">round</span><span class="s8">(</span><span class="s1">res</span><span class="s8">.</span><span class="s1">throughput</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">throughput</span><span class="s8">,</span><span class="s1"> unit</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"veh/hr"</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Overflows"</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">overflows</span><span class="s8">,</span><span class="s1"> color</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">overflows </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s10">"text-red-600"</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s10">"text-gray-800"</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>panel</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> cards</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">c </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s10">`</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="text-center p-3 bg-gray-50 rounded border border-gray-100"&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-xs text-gray-500 uppercase tracking-wide"&gt;</span><span class="s8">${</span><span class="s4">c</span><span class="s8">.</span><span class="s4">label</span><span class="s8">}</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-xl font-bold </span><span class="s8">${</span><span class="s4">c</span><span class="s8">.</span><span class="s4">color </span><span class="s8">||</span><span class="s4"> </span><span class="s1">'text-gray-800'</span><span class="s8">}</span><span class="s1">"&gt;</span><span class="s8">${</span><span class="s4">c</span><span class="s8">.</span><span class="s4">val</span><span class="s8">}</span><span class="s1"> &lt;span class="text-xs font-normal text-gray-400"&gt;</span><span class="s8">${</span><span class="s4">c</span><span class="s8">.</span><span class="s4">unit </span><span class="s8">||</span><span class="s4"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>`</span><span class="s8">).</span><span class="s4">join</span><span class="s8">(</span><span class="s1">''</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> renderValidation</span><span class="s8">(</span><span class="s1">res</span><span class="s8">,</span><span class="s1"> cfg</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> table </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'validation-table'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> warning </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'stability-warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> lambda </span><span class="s8">=</span><span class="s1"> cfg</span><span class="s8">.</span><span class="s1">arrivalRate </span><span class="s8">/</span><span class="s1"> </span><span class="s15">3600</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> mu </span><span class="s8">=</span><span class="s1"> </span><span class="s15">1</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> cfg</span><span class="s8">.</span><span class="s1">dwellTime</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> rho </span><span class="s8">=</span><span class="s1"> lambda </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">servers </span><span class="s8">*</span><span class="s1"> mu</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>warning</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">,</span><span class="s1"> rho </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s15">1</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">cfg</span><span class="s8">.</span><span class="s1">serviceDist </span><span class="s8">!==</span><span class="s1"> </span><span class="s10">'exponential'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>table</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`&lt;tr&gt;&lt;td colspan="5" class="p-4 text-center text-gray-500 italic"&gt;Validation available for M/M/s (Exponential) only.&lt;/td&gt;&lt;/tr&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> theory </span><span class="s8">=</span><span class="s1"> calculateTheory</span><span class="s8">(</span><span class="s1">lambda</span><span class="s8">,</span><span class="s1"> mu</span><span class="s8">,</span><span class="s1"> cfg</span><span class="s8">.</span><span class="s1">servers</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">theory</span><span class="s8">.</span><span class="s1">stable</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>table</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">`&lt;tr&gt;&lt;td colspan="5" class="p-4 text-center text-red-500 font-bold"&gt;System Unstable (Rho = </span><span class="s8">${</span><span class="s4">theory</span><span class="s8">.</span><span class="s4">rho</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s15">2</span><span class="s8">)}</span><span class="s1"> â‰¥ 1).&lt;/td&gt;&lt;/tr&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> rows </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Avg Queue (Lq)"</span><span class="s8">,</span><span class="s1"> sim</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Lq</span><span class="s8">,</span><span class="s1"> theo</span><span class="s8">:</span><span class="s1"> theory</span><span class="s8">.</span><span class="s14">Lq</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Avg Wait (Wq)"</span><span class="s8">,</span><span class="s1"> sim</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s14">Wq</span><span class="s8">,</span><span class="s1"> theo</span><span class="s8">:</span><span class="s1"> theory</span><span class="s8">.</span><span class="s14">Wq</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Utilization"</span><span class="s8">,</span><span class="s1"> sim</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">utilization</span><span class="s8">,</span><span class="s1"> theo</span><span class="s8">:</span><span class="s1"> theory</span><span class="s8">.</span><span class="s1">utilization </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">{</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> </span><span class="s10">"Prob(Wait &gt; 0)"</span><span class="s8">,</span><span class="s1"> sim</span><span class="s8">:</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">probWait</span><span class="s8">,</span><span class="s1"> theo</span><span class="s8">:</span><span class="s1"> theory</span><span class="s8">.</span><span class="s14">Pw</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>table</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> rows</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">r </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> simVal </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s12">typeof</span><span class="s1"> r</span><span class="s8">.</span><span class="s1">sim </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'number'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> r</span><span class="s8">.</span><span class="s1">sim </span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s1"> theoVal </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s12">typeof</span><span class="s1"> r</span><span class="s8">.</span><span class="s1">theo </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'number'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> r</span><span class="s8">.</span><span class="s1">theo </span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">let</span><span class="s1"> diff </span><span class="s8">=</span><span class="s1"> </span><span class="s15">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">theoVal </span><span class="s8">!==</span><span class="s1"> </span><span class="s15">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>diff </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Math</span><span class="s8">.</span><span class="s1">abs</span><span class="s8">((</span><span class="s1">simVal </span><span class="s8">-</span><span class="s1"> theoVal</span><span class="s8">)</span><span class="s1"> </span><span class="s8">/</span><span class="s1"> theoVal</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s15">100</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">const</span><span class="s4"> color </span><span class="s8">=</span><span class="s4"> diff </span><span class="s8">&lt;</span><span class="s4"> </span><span class="s15">5</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> </span><span class="s1">"text-green-600"</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s8">(</span><span class="s4">diff </span><span class="s8">&lt;</span><span class="s4"> </span><span class="s15">15</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> </span><span class="s1">"text-yellow-600"</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">"text-red-600"</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s12">return</span><span class="s4"> </span><span class="s1">`&lt;tr class="border-b border-gray-100 hover:bg-gray-50"&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;td class="p-2 font-medium text-gray-700"&gt;</span><span class="s8">${</span><span class="s4">r</span><span class="s8">.</span><span class="s4">name</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;td class="p-2 text-gray-800"&gt;</span><span class="s8">${</span><span class="s4">simVal</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s15">3</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;td class="p-2 text-gray-500"&gt;</span><span class="s8">${</span><span class="s4">theoVal</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s15">3</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;td class="p-2 </span><span class="s8">${</span><span class="s4">color</span><span class="s8">}</span><span class="s1"> font-bold"&gt;</span><span class="s8">${</span><span class="s4">diff</span><span class="s8">.</span><span class="s4">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">)}</span><span class="s1">%&lt;/td&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;td class="p-2 text-xs"&gt;</span><span class="s8">${</span><span class="s4">diff </span><span class="s8">&lt;</span><span class="s4"> </span><span class="s15">5</span><span class="s4"> </span><span class="s8">?</span><span class="s4"> </span><span class="s1">'âœ… Good'</span><span class="s4"> </span><span class="s8">:</span><span class="s4"> </span><span class="s1">'âš ï¸ Deviated'</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/tr&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">}).</span><span class="s1">join</span><span class="s8">(</span><span class="s10">''</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> renderCharts</span><span class="s8">(</span><span class="s1">res</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// Render Distributions first</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> config </span><span class="s8">=</span><span class="s1"> getConfig</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>renderDistributionCharts</span><span class="s8">(</span><span class="s1">res</span><span class="s8">,</span><span class="s1"> config</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">res</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> labels </span><span class="s8">=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">d </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">(</span><span class="s1">d</span><span class="s8">.</span><span class="s1">t</span><span class="s8">/</span><span class="s15">60</span><span class="s8">).</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">1</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> dataQ </span><span class="s8">=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">d </span><span class="s8">=&gt;</span><span class="s1"> d</span><span class="s8">.</span><span class="s1">q</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> dataSys </span><span class="s8">=</span><span class="s1"> res</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">d </span><span class="s8">=&gt;</span><span class="s1"> d</span><span class="s8">.</span><span class="s1">sys</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>createChart</span><span class="s8">(</span><span class="s1">'chart-queue'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'line'</span><span class="s8">,</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> labels</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Queue Length'</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> dataQ</span><span class="s8">,</span><span class="s1"> borderColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#2563eb'</span><span class="s8">,</span><span class="s1"> backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'rgba(37, 99, 235, 0.1)'</span><span class="s8">,</span><span class="s1"> fill</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> tension</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0.3</span><span class="s8">,</span><span class="s1"> pointRadius</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">}]</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s4"> </span><span class="s1">'Time (min)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Vehicles'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>createChart</span><span class="s8">(</span><span class="s1">'chart-system'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'line'</span><span class="s8">,</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> labels</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Total in System'</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> dataSys</span><span class="s8">,</span><span class="s1"> borderColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#059669'</span><span class="s8">,</span><span class="s1"> borderWidth</span><span class="s8">:</span><span class="s1"> </span><span class="s15">1</span><span class="s8">,</span><span class="s1"> pointRadius</span><span class="s8">:</span><span class="s1"> </span><span class="s15">0</span><span class="s1"> </span><span class="s8">}]</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s4"> </span><span class="s1">'Time (min)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Vehicles'</span><span class="s8">);</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxSweep </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-sweep'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">ctxSweep</span><span class="s8">))</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">ctxSweep</span><span class="s8">).</span><span class="s1">destroy</span><span class="s8">();</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>ctxSweep</span><span class="s8">.</span><span class="s4">parentElement</span><span class="s8">.</span><span class="s4">innerHTML </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'&lt;canvas id="chart-sweep"&gt;&lt;/canvas&gt;&lt;div class="text-center text-xs text-gray-400 mt-[-50%]"&gt;Run Sweep to view&lt;/div&gt;'</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctxHist </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'chart-wait-hist'</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s8">(</span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">ctxHist</span><span class="s8">))</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">ctxHist</span><span class="s8">).</span><span class="s1">destroy</span><span class="s8">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">Â Â  Â </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>charts</span><span class="s8">[</span><span class="s10">'hist'</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctxHist</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'bar'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> labels</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s10">'Avg Wait'</span><span class="s8">],</span><span class="s1"> datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Avg Waiting Time (sec)'</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[</span><span class="s1">res</span><span class="s8">.</span><span class="s14">Wq</span><span class="s8">],</span><span class="s1"> backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#7c3aed'</span><span class="s1"> </span><span class="s8">}]</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">});</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> renderSweepChart</span><span class="s8">(</span><span class="s1">data</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>createChart</span><span class="s8">(</span><span class="s1">'chart-sweep'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'line'</span><span class="s8">,</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>labels</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">d </span><span class="s8">=&gt;</span><span class="s1"> d</span><span class="s8">.</span><span class="s1">x</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">0</span><span class="s8">)),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>datasets</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> label</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'Avg Wait (Wq) vs Arrival Rate'</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">map</span><span class="s8">(</span><span class="s1">d </span><span class="s8">=&gt;</span><span class="s1"> d</span><span class="s8">.</span><span class="s1">y</span><span class="s8">),</span><span class="s1"> borderColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#db2777'</span><span class="s8">,</span><span class="s1"> backgroundColor</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'rgba(219, 39, 119, 0.1)'</span><span class="s8">,</span><span class="s1"> fill</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s1"> </span><span class="s8">}]</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">},</span><span class="s4"> </span><span class="s1">'Arrival Rate (Veh/hr)'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'Avg Wait (sec)'</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> createChart</span><span class="s8">(</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> type</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">,</span><span class="s1"> xLabel</span><span class="s8">,</span><span class="s1"> yLabel</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s1">// FIX: Check for any existing chart instance on this canvas ID and destroy it</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> existing </span><span class="s8">=</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">.</span><span class="s1">getChart</span><span class="s8">(</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">existing</span><span class="s8">)</span><span class="s1"> existing</span><span class="s8">.</span><span class="s1">destroy</span><span class="s8">();</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> ctx </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s1">id</span><span class="s8">).</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>charts</span><span class="s8">[</span><span class="s1">id</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s14">Chart</span><span class="s8">(</span><span class="s1">ctx</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>type</span><span class="s8">:</span><span class="s1"> type</span><span class="s8">,</span><span class="s1"> data</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>options</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>responsive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> maintainAspectRatio</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>interaction</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> mode</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'index'</span><span class="s8">,</span><span class="s1"> intersect</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>plugins</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> legend</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s1"> </span><span class="s8">},</span><span class="s1"> tooltip</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> enabled</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>scales</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> x</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> xLabel </span><span class="s8">}</span><span class="s1"> </span><span class="s8">},</span><span class="s1"> y</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> title</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> display</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s8">,</span><span class="s1"> text</span><span class="s8">:</span><span class="s1"> yLabel </span><span class="s8">},</span><span class="s1"> beginAtZero</span><span class="s8">:</span><span class="s1"> </span><span class="s12">true</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s8">});</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p5"><span class="s7"></span><br></p>
<p class="p4"><span class="s12">function</span><span class="s1"> clearCharts</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s14">Object</span><span class="s8">.</span><span class="s1">keys</span><span class="s8">(</span><span class="s1">charts</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">k </span><span class="s8">=&gt;</span><span class="s1"> charts</span><span class="s8">[</span><span class="s1">k</span><span class="s8">].</span><span class="s1">destroy</span><span class="s8">());</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s12">function</span><span class="s1"> exportCSV</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">lastResults </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">lastResults</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> alert</span><span class="s8">(</span><span class="s10">"Please run a simulation first."</span><span class="s8">);</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">let</span><span class="s4"> csvContent </span><span class="s8">=</span><span class="s4"> </span><span class="s1">"data:text/csv;charset=utf-8,Time_Min,Queue_Length,System_Count\n"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>lastResults</span><span class="s8">.</span><span class="s1">timeSeries</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">row </span><span class="s8">=&gt;</span><span class="s1"> csvContent </span><span class="s8">+=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${(</span><span class="s1">row</span><span class="s8">.</span><span class="s1">t</span><span class="s8">/</span><span class="s15">60</span><span class="s8">).</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s15">4</span><span class="s8">)}</span><span class="s10">,</span><span class="s8">${</span><span class="s1">row</span><span class="s8">.</span><span class="s1">q</span><span class="s8">}</span><span class="s10">,</span><span class="s8">${</span><span class="s1">row</span><span class="s8">.</span><span class="s1">sys</span><span class="s8">}</span><span class="s10">\n`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span></span><span class="s12">const</span><span class="s1"> link </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s10">"a"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>link</span><span class="s8">.</span><span class="s1">href </span><span class="s8">=</span><span class="s1"> encodeURI</span><span class="s8">(</span><span class="s1">csvContent</span><span class="s8">);</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">Â  Â  </span>link</span><span class="s8">.</span><span class="s4">download </span><span class="s8">=</span><span class="s4"> </span><span class="s1">"simulation_results.csv"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">link</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>link</span><span class="s8">.</span><span class="s1">click</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">removeChild</span><span class="s8">(</span><span class="s1">link</span><span class="s8">);</span></p>
<p class="p9"><span class="s1">}</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
